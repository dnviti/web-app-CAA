<!DOCTYPE html>
<html>
<head>
    <title>API Test</title>
</head>
<body>
    <h1>API Authentication Test</h1>
    
    <button onclick="testLogin()">Test Login</button>
    <button onclick="testGetGrid()">Test Get Grid</button>
    <button onclick="testWithToken()">Test With Manual Token</button>
    <button onclick="checkLocalStorage()">Check LocalStorage</button>
    
    <div id="output"></div>
    
    <script>
        const output = document.getElementById('output');
        
        function log(message) {
            output.innerHTML += '<div>' + JSON.stringify(message, null, 2) + '</div>';
        }
        
        function clearLog() {
            output.innerHTML = '';
        }
        
        async function testLogin() {
            clearLog();
            try {
                const response = await fetch('http://localhost:6542/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        username: 'test',
                        password: 'test'
                    })
                });
                const data = await response.json();
                log({ status: response.status, data });
                
                if (data.token) {
                    localStorage.setItem('jwt_token', data.token);
                    log('Token stored in localStorage');
                }
            } catch (error) {
                log({ error: error.message });
            }
        }
        
        async function testGetGrid() {
            clearLog();
            const token = localStorage.getItem('jwt_token');
            log({ hasToken: !!token, tokenLength: token?.length });
            
            try {
                const headers = {
                    'Content-Type': 'application/json',
                };
                
                if (token) {
                    headers.Authorization = `Bearer ${token}`;
                }
                
                const response = await fetch('http://localhost:6542/api/grid', {
                    method: 'GET',
                    headers
                });
                const data = await response.json();
                log({ status: response.status, data });
            } catch (error) {
                log({ error: error.message });
            }
        }
        
        async function testWithToken() {
            clearLog();
            try {
                const response = await fetch('http://localhost:6542/api/auth/verify', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer test-token'
                    }
                });
                const data = await response.json();
                log({ status: response.status, data });
            } catch (error) {
                log({ error: error.message });
            }
        }
        
        function checkLocalStorage() {
            clearLog();
            const token = localStorage.getItem('jwt_token');
            const refreshToken = localStorage.getItem('refresh_token');
            log({
                jwt_token: token,
                refresh_token: refreshToken,
                hasJwt: !!token,
                hasRefresh: !!refreshToken
            });
        }
    </script>
</body>
</html>
